#	Targets:
# 		all (default):
#			testrvm rvm_basher
# 		install: 
#			testrvm rvm_basher -> $(BINDIR)

#
#
# BLURB lgpl
# 
#                            Coda File System
#                               Release 5
# 
#           Copyright (c) 1987-1999 Carnegie Mellon University
#                   Additional copyrights listed below
# 
# This  code  is  distributed "AS IS" without warranty of any kind under
# the  terms of the  GNU  Library General Public Licence  Version 2,  as
# shown in the file LICENSE. The technical and financial contributors to
# Coda are listed in the file CREDITS.
# 
#                         Additional copyrights
#                            none currently
# 
#*/
#   	RVM Test Programs Makefile

TOPDIR = @top_srcdir@

srcdir = @srcdir@
VPATH  = @srcdir@
TOPOBJ = @TOPOBJ@

# Need to conditionalize this
include $(TOPDIR)/Makeconf

EXECUTABLES = testrvm rvm_basher lwp_basher
TESTS = testrvm rvm_basher lwp_basher

TESTRVM_LIBS    = $(LIBRVM) $(LIBCOMPAT) $(LIBBASE)
RVM_BASHER_LIBS = $(LIBRDS) $(LIBSEG) $(LIBRVM) $(LIBCOMPAT) $(LIBBASE)
LWP_BASHER_LIBS = $(LIBRDSLWP) $(LIBSEG) $(LIBRVMLWP) $(LIBOLDLWP) \
		  $(LIBCOMPAT) $(LIBBASE)

# re-install this when libplumber is ready, for mach platform -- clement
# LWP_BASHER_LIBS = $(LIBRDSLWP) $(LIBSEG) $(LIBRVMLWP) $(LIBOLDLWP) \
#                  $(LIBPLUMBER)
# CFLAGS := $(CFLAGS) -DHAS_PLUMBER


testrvm: testrvm.o $(TESTRVM_LIBS)
	$(CC) $(LIBFLAGS) testrvm.o $(TESTRVM_LIBS) -o testrvm

rvm_basher: rvm_basher.o $(RVM_BASHER_LIBS)
	$(CC) $(LIBFLAGS) rvm_basher.o $(RVM_BASHER_LIBS) -o rvm_basher

# Coda-specific installations

lwp_basher.o:	rvm_basher.c 
	-mv rvm_basher.o xxx_basher.o
	${MAKE} CFLAGS="$(CFLAGS) -DRVM_USELWP" rvm_basher.o
	mv rvm_basher.o lwp_basher.o
	-mv xxx_basher.o rvm_basher.o

lwp_basher: lwp_basher.o $(LWP_BASHER_LIBS)
	    $(CC) $(LIBFLAGS) lwp_basher.o $(LWP_BASHER_LIBS) -o lwp_basher


include $(TOPDIR)/configs/Makerules

