#	Targets:
# 		all (default):
#			testrvm rvm_basher
# 		install: 
#			testrvm rvm_basher -> $(BINDIR)

#
#
#     RVM: an Experimental Recoverable Virtual Memory Package
#			Release 1.3
#
#       Copyright (c) 1990-1994 Carnegie Mellon University
#                      All Rights Reserved.
#
# Permission  to use, copy, modify and distribute this software and
# its documentation is hereby granted (including for commercial  or
# for-profit use), provided that both the copyright notice and this
# permission  notice  appear  in  all  copies  of   the   software,
# derivative  works or modified versions, and any portions thereof,
# and that both notices appear  in  supporting  documentation,  and
# that  credit  is  given  to  Carnegie  Mellon  University  in all
# publications reporting on direct or indirect use of this code  or
# its derivatives.
#
# RVM  IS  AN  EXPERIMENTAL  SOFTWARE  PACKAGE AND IS KNOWN TO HAVE
# BUGS, SOME OF WHICH MAY  HAVE  SERIOUS  CONSEQUENCES.    CARNEGIE
# MELLON ALLOWS FREE USE OF THIS SOFTWARE IN ITS "AS IS" CONDITION.
# CARNEGIE MELLON DISCLAIMS ANY  LIABILITY  OF  ANY  KIND  FOR  ANY
# DAMAGES  WHATSOEVER RESULTING DIRECTLY OR INDIRECTLY FROM THE USE
# OF THIS SOFTWARE OR OF ANY DERIVATIVE WORK.
#
# Carnegie Mellon encourages (but does not require) users  of  this
# software to return any improvements or extensions that they make,
# and to grant Carnegie Mellon the  rights  to  redistribute  these
# changes  without  encumbrance.   Such improvements and extensions
# should be returned to Software.Distribution@cs.cmu.edu.
#
# rcsid = $Header$
#

#   	RVM Test Programs Makefile

TOPDIR = @top_srcdir@

srcdir = @srcdir@
VPATH  = @srcdir@
TOPOBJ = @TOPOBJ@

# Need to conditionalize this
include $(TOPDIR)/Makeconf

EXECUTABLES = testrvm rvm_basher lwp_basher
TESTS = testrvm rvm_basher lwp_basher

TESTRVM_LIBS    = $(LIBRVM) $(LIBCOMPAT) $(LIBBASE)
RVM_BASHER_LIBS = $(LIBRDS) $(LIBSEG) $(LIBRVM) $(LIBCOMPAT) $(LIBBASE)
LWP_BASHER_LIBS = $(LIBRDSLWP) $(LIBSEG) $(LIBRVMLWP) $(LIBOLDLWP) \
		  $(LIBCOMPAT) $(LIBBASE)

# re-install this when libplumber is ready, for mach platform -- clement
# LWP_BASHER_LIBS = $(LIBRDSLWP) $(LIBSEG) $(LIBRVMLWP) $(LIBOLDLWP) \
#                  $(LIBPLUMBER)
# CFLAGS := $(CFLAGS) -DHAS_PLUMBER


testrvm: testrvm.o $(TESTRVM_LIBS)
	$(CC) $(LIBFLAGS) testrvm.o $(TESTRVM_LIBS) -o testrvm

rvm_basher: rvm_basher.o $(RVM_BASHER_LIBS)
	$(CC) $(LIBFLAGS) rvm_basher.o $(RVM_BASHER_LIBS) -o rvm_basher

# Coda-specific installations

lwp_basher.o:	rvm_basher.c 
	-mv rvm_basher.o xxx_basher.o
	${MAKE} CFLAGS="$(CFLAGS) -DRVM_USELWP" rvm_basher.o
	mv rvm_basher.o lwp_basher.o
	-mv xxx_basher.o rvm_basher.o

lwp_basher: lwp_basher.o $(LWP_BASHER_LIBS)
	    $(CC) $(LIBFLAGS) lwp_basher.o $(LWP_BASHER_LIBS) -o lwp_basher


include $(TOPDIR)/configs/Makerules

