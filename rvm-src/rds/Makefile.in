#
#
# BLURB lgpl
# 
#                            Coda File System
#                               Release 5
# 
#           Copyright (c) 1987-1999 Carnegie Mellon University
#                   Additional copyrights listed below
# 
# This  code  is  distributed "AS IS" without warranty of any kind under
# the  terms of the  GNU  Library General Public Licence  Version 2,  as
# shown in the file LICENSE. The technical and financial contributors to
# Coda are listed in the file CREDITS.
# 
#                         Additional copyrights
#                            none currently
# 
#*/

TOPDIR = @top_srcdir@

srcdir = @srcdir@
VPATH  = @srcdir@
TOPOBJ = @TOPOBJ@

include $(TOPDIR)/Makeconf

LIBOBJ = rds_coalesce.o rds_free.o rds_init.o rds_malloc.o rds_prealloc.o \
       rds_split.o rds_stats.o rds_start.o rds_util.o rds_zap.o 

OBJ = rdsinit.o
DEPLIBS = $(LIBSEG) $(LIBRVM) $(LIBTHREADS) $(LIBBASE)
LIBS := $(DEPLIBS) $(LIBLWP) $(LIBCOMPAT) $(LIBFIXUP) $(LIBS)


HERE := $(shell basename `pwd`)
ifeq ($(HERE),rdslwp)
RVMTARGET := lwp
endif


ifeq ($(RVMTARGET),)
EXECUTABLES = rdsinit 
SSBINS      = rdsinit
LIBRARIES   = librds.a 
EXPHEADERS = rds.h
PRIVHEADERS = rds_private.h

HEADERS     = ${EXPHEADERS} ${PRIVHEADERS}
librds.a: $(LIBOBJ)

rdsinit: $(OBJ) librds.a $(DEPLIBS)
	$(CC) $(LDFLAGS) $(OBJ) librds.a $(LIBS) -o rdsinit
endif


ifeq ($(RVMTARGET),lwp)
CFLAGS += -DRVM_USELWP
LIBRARIES = librdslwp.a

%.o : $(srcdir)/../rds/%.c
	$(CC) $(CFLAGS) -c $< -o $@
	@mkdir -p .depfiles ; mv $*.d .depfiles

librdslwp.a: $(LIBOBJ)
endif

ifeq ($(RVMTARGET), pthread)
CFLAGS += -DRVM_USEPT -DREENTRANT

endif

include $(TOPDIR)/configs/Makerules
