# 
# BLURB gpl
# 
#                            Coda File System
#                               Release 5
# 
#           Copyright (c) 1987-1999 Carnegie Mellon University
#                   Additional copyrights listed below
# 
# This  code  is  distributed "AS IS" without warranty of any kind under
# the terms of the GNU General Public Licence Version 2, as shown in the
# file  LICENSE.  The  technical and financial  contributors to Coda are
# listed in the file CREDITS.
# 
#                         Additional copyrights
#                            none currently
# 
#*/

TOPDIR = @top_srcdir@

srcdir = @srcdir@
VPATH  = @srcdir@
TOPOBJ = @TOPOBJ@

include $(TOPDIR)/Makeconf

LOGSCRIPTS = logbandwidth logcmls logreintegration logprogress
EXECUTABLES = cmon codacon cfs hoard spy replay $(LOGSCRIPTS)
ifeq ($(SYS),cygwin32)
EXECUTABLES = codacon cfs hoard spy replay
endif

CBINS       = $(EXECUTABLES)

CMON_LIBS   =  $(LIBVICEDEP) $(LIBBASE)
CFS_LIBS    = $(LIBKERNDEP) $(LIBUTIL) $(LIBBASE)
HOARD_LIBS  = $(LIBUTIL) $(LIBKERNDEP) $(LIBBASE)
STD_LIBS = $(LIBCURSES) $(LIBS)

CXXFLAGS := $(CXXFLAGS) -UVENUS -DSYSCONFDIR=\"@sysconfdir@\"

include $(TOPDIR)/configs/Makerules

cmon: cmon.o $(CMON_LIBS)
	$(CXX) $(LDFLAGS) cmon.o $(CMON_LIBS) $(LIBRPC2) $(LIBSE) $(LIBLWP) $(LIBCOMPAT) $(STD_LIBS) -o cmon

codacon:    codacon.o
	$(CXX) $(LDFLAGS) codacon.o $(LIBBASE) $(LIBS) -o codacon

cfs:  cfs.o $(CFS_LIBS)
	$(CXX) $(LDFLAGS) cfs.o $(CFS_LIBS) $(STD_LIBS) -o cfs

hoard: hoard.o $(HOARD_LIBS)
	$(CXX) $(LDFLAGS) hoard.o $(HOARD_LIBS) $(STD_LIBS) -o hoard

spy: spy.o
	$(CXX) $(LDFLAGS) spy.o $(LIBBASE) $(LIBS) -o spy

replay: replay.o
	$(CXX) $(LDFLAGS) replay.o $(LIBS) -o replay

# up is broken on the pmax because a.out.h seems incomplete
# fix if up is really needed (Satya 3/23/92)
up: up.o
	$(CXX) $(LDFLAGS)  up.o -o up

logbandwidth: logbandwidth.in translate.sed
	sed -f translate.sed  $< > $@
	chmod 755 $@

logcmls: logcmls.in translate.sed
	sed -f translate.sed  $< > $@
	chmod 755 $@

logreintegration: logreintegration.in translate.sed
	sed -f translate.sed  $< > $@
	chmod 755 $@

logprogress: logprogress.in translate.sed
	sed -f translate.sed  $< > $@
	chmod 755 $@

translate.sed: Makefile
	echo "s%+TIXWISH+%@TIXWISH@%g" >> $@

# this way translate.sed is cleaned up as well
TESTS = translate.sed
