# 
# BLURB gpl
# 
#                            Coda File System
#                               Release 6
# 
#           Copyright (c) 1987-2003 Carnegie Mellon University
#                   Additional copyrights listed below
# 
# This  code  is  distributed "AS IS" without warranty of any kind under
# the terms of the GNU General Public Licence Version 2, as shown in the
# file  LICENSE.  The  technical and financial  contributors to Coda are
# listed in the file CREDITS.
# 
#                         Additional copyrights
#                            none currently
# 
#*/

TOPDIR = @top_srcdir@

srcdir = @srcdir@
VPATH  = @srcdir@
TOPOBJ = @TOPOBJ@

include $(TOPDIR)/Makeconf

LOGSCRIPTS = # logbandwidth logcmls logreintegration logprogress
EXECUTABLES = codacon cfs hoard spy coda_replay
ifneq ($(SYS),cygwin32)
EXECUTABLES += cmon $(LOGSCRIPTS)
endif

CBINS := $(EXECUTABLES)
CSBINS = codaconfedit
SSBINS = codaconfedit
EXECUTABLES += codaconfedit
CMANPAGES := cfs.1

CMON_LIBS   = $(LIBVICEDEP) $(LIBBASE)
CFS_LIBS    = $(LIBKERNDEP) $(LIBUTIL) $(LIBBASE)
HOARD_LIBS  = $(LIBUTIL) $(LIBKERNDEP) $(LIBBASE)
STD_LIBS = $(LIBCURSES) $(LIBCRYPTO) $(LIBS)

CXXFLAGS := $(CXXFLAGS) -UVENUS

include $(TOPDIR)/configs/Makerules

cmon: cmon.o $(CMON_LIBS)
	$(CXX) $(LDFLAGS) cmon.o $(CMON_LIBS) $(LIBRPC2) $(LIBSE) $(LIBLWP) $(LIBCOMPAT) $(STD_LIBS) -o cmon

codacon: codacon.o $(LIBBASE)
	$(CXX) $(LDFLAGS) codacon.o $(LIBBASE) $(LIBCRYPTO) $(LIBS) -o codacon

codaconfedit: codaconfedit.o $(LIBBASE)
	$(CXX) $(LDFLAGS) codaconfedit.o $(LIBBASE) $(LIBCRYPTO) $(LIBS) -o codaconfedit

cfs:  cfs.o $(CFS_LIBS)
	$(CXX) $(LDFLAGS) cfs.o $(CFS_LIBS) $(STD_LIBS) -o cfs

hoard: hoard.o $(HOARD_LIBS)
	$(CXX) $(LDFLAGS) hoard.o $(HOARD_LIBS) $(STD_LIBS) -o hoard

spy: spy.o $(LIBBASE)
	$(CXX) $(LDFLAGS) spy.o $(LIBBASE) $(LIBCRYPTO) $(LIBS) -o spy

coda_replay: replay.o
	$(CXX) $(LDFLAGS) replay.o $(LIBS) -o coda_replay

# up is broken on the pmax because a.out.h seems incomplete
# fix if up is really needed (Satya 3/23/92)
up: up.o
	$(CXX) $(LDFLAGS)  up.o -o up

logbandwidth: logbandwidth.in translate.sed
	sed -f translate.sed  $< > $@
	chmod 755 $@

logcmls: logcmls.in translate.sed
	sed -f translate.sed  $< > $@
	chmod 755 $@

logreintegration: logreintegration.in translate.sed
	sed -f translate.sed  $< > $@
	chmod 755 $@

logprogress: logprogress.in translate.sed
	sed -f translate.sed  $< > $@
	chmod 755 $@

translate.sed: Makefile
	echo "s%+TIXWISH+%@TIXWISH@%g" >> $@

# this way translate.sed is cleaned up as well
TESTS = translate.sed

