# 
# BLURB lgpl
# 
#                            Coda File System
#                               Release 5
# 
#           Copyright (c) 1987-1999 Carnegie Mellon University
#                   Additional copyrights listed below
# 
# This  code  is  distributed "AS IS" without warranty of any kind under
# the  terms of the  GNU  Library General Public Licence  Version 2,  as
# shown in the file LICENSE. The technical and financial contributors to
# Coda are listed in the file CREDITS.
# 
#                         Additional copyrights
#                            none currently
# 
#*/



TOPDIR = @top_srcdir@

srcdir = @srcdir@
VPATH  = @srcdir@
TOPOBJ = @TOPOBJ@

include $(TOPDIR)/Makeconf

EXECUTABLES  = ctest stest rpc2test
LIBRARIES    = librpc2.a libse.a
HEADERS	     = rpc2.h se.h multi.h sftp.h rpc2.private.h errors.h errorsdefs.h

CFLAGS := -Wall -DRPC2DEBUG -DERRORTR $(CFLAGS)
AFLAGS := -DRPC2DEBUG $(AFLAGS)

LIBS	= $(LIBOLDLWP) $(LIBCOMPAT) $(LIBBASE)

HFILES	  = rpc2.h rpc2.private.h se.h cbuf.h trace.h multi.h 
SEHFILES  = sftp.h
OFILES	  = rpc2a.o  rpc2b.o sl.o packet.o secure.o globals.o\
	    se.o lists.o ct.o debug.o conn.o cbuf.o ffs.o\
	    host.o multi1.o multi2.o multi3.o mkcall.o\
	    stats.o errors.o
SEOFILES  = sftp1.o sftp2.o sftp3.o sftp4.o sftp5.o sftp6.o
ASMOFILES = fxor.o
TESTHFILES = test.h

# Special case of errors:
errors.o: errordb.txt
	perl ${srcdir}/makeinc.pl < ${srcdir}/errordb.txt
	$(CC) $(CFLAGS) -c ${srcdir}/errors.c


# Libraries
librpc2.a: $(OFILES) $(ASMOFILES)
libse.a: $(SEOFILES)

# Test programs
${EXECUTABLES}: librpc2.a libse.a $(LIBS)
	$(CC) $(LIBFLAGS) $@.o librpc2.a libse.a $(LIBS) -o $@

# Dependencies for object files
ctest: ctest.o
stest: stest.o
rpc2test: rpc2test.o


include $(TOPDIR)/configs/Makerules
