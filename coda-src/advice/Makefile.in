# 
# BLURB gpl
# 
#                            Coda File System
#                               Release 5
# 
#           Copyright (c) 1987-1999 Carnegie Mellon University
#                   Additional copyrights listed below
# 
# This  code  is  distributed "AS IS" without warranty of any kind under
# the terms of the GNU General Public Licence Version 2, as shown in the
# file  LICENSE.  The  technical and financial  contributors to Coda are
# listed in the file CREDITS.
# 
#                         Additional copyrights
#                            none currently
# 
#*/

TOPDIR = @top_srcdir@

srcdir = @srcdir@
VPATH  = @srcdir@
TOPOBJ = @TOPOBJ@

include $(TOPDIR)/Makeconf

EXECUTABLES = advice_srv 
LIBRARIES = libadvice.a libfakeadvice.a
CBINS      = $(EXECUTABLES)


DEPLIBS := $(LIBUTIL) $(LIBVICEDEP) $(LIBKERNDEP) $(LIBBASE)
LIBS := $(DEPLIBS) $(LIBRPC2) $(LIBSE) $(LIBFAIL) $(LIBLWP) $(LIBSYS) \
	$(LIBKVM) $(LIBDB) $(LIBS)

AOBJS = console_handler.o counters.o daemon.o data.o \
	fail.o filecopy.o globals.o helpers.o conversions.o miss.o \
	mybstree.o programspy.o replacementlog.o rpcs.o volent.o

OBJS = $(AOBJS) advice_srv.o

REALRPCSETUP = rpc_setup.o
FAKERPCSETUP = fake_rpc_setup.o

CXXFLAGS += -DCODACONSOLE=\"$(GUIDIR)/CodaConsole\"

libadvice.a: ${AOBJS} ${REALRPCSETUP}

libfakeadvice.a: ${AOBJS} ${FAKERPCSETUP}

replacementlog.o: replacementlog.cc
	$(CXX) $(CFLAGS) -c $<

fake_rpc_setup.o: rpc_setup.cc
	$(CXX) $(CFLAGS) -D__FAKE__ -c ${srcdir}/rpc_setup.cc -o fake_rpc_setup.o

advice_srv: advice_srv.h $(DEPLIBS) libadvice.a advice_srv.o
	$(CXX) $(LDFLAGS) advice_srv.o libadvice.a $(LIBS) -o advice_srv

include $(TOPDIR)/configs/Makerules
