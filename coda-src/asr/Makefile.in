# 
# BLURB gpl
# 
#                            Coda File System
#                               Release 5
# 
#           Copyright (c) 1987-1999 Carnegie Mellon University
#                   Additional copyrights listed below
# 
# This  code  is  distributed "AS IS" without warranty of any kind under
# the terms of the GNU General Public Licence Version 2, as shown in the
# file  LICENSE.  The  technical and financial  contributors to Coda are
# listed in the file CREDITS.
# 
#                         Additional copyrights
#                            none currently
# 
#*/

TOPDIR = @top_srcdir@

srcdir = @srcdir@
VPATH  = @srcdir@
TOPOBJ = @TOPOBJ@

include $(TOPDIR)/Makeconf

EXECUTABLES = parser
ifeq ($(SYS),cywin32)
EXECUTABLES = parser
endif
CBINS       = $(EXECUTABLES)
HEADERS     = asr.h ruletypes.h

DEPLIBS = $(LIBKERNDEP) $(LIBUTIL) $(LIBBASE)
LIBS := $(DEPLIBS) $(LEXLIB) $(LIBS)

#uncomment if you want to turn on timing of the ASR 
#PERSONAL_FLAGS= -DTIMING

OBJECTS = resolver_parser.o resolver_lexer.o ruletypes.o resolver.o wildmat.o path.o

include $(TOPDIR)/configs/Makerules

YFLAGS= -d
EXTRACLEAN=resolver_parser.h

resolver_parser.c: resolver_parser.h
resolver_parser.h: resolver_parser.y
	$(YACC) $(YFLAGS) $< && mv y.tab.c $*.c && mv y.tab.h $*.h

parser: ${OBJECTS} $(DEPLIBS)
	$(CXX) $(LDFLAGS) ${OBJECTS} $(LIBS) -o parser

# YYuck!  I don't know how to tell yyac to deliver a .cc extension  GRRR..(pjb)
resolver_parser.o: resolver_parser.c
	$(CXX) -x c++ $(CFLAGS) -c $<
        
TESTS= resolver_lexer.c resolver_parser.c y.tab.h
