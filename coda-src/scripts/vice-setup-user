#!/bin/sh

# Set up password and group files for Coda

cd /vice/db

echo "Setting up users and groups for Coda"
echo
echo "You need to give me a nonzero uid of a user on this system,"
echo "who will be a Coda System:Administrator member,"
echo "(sort of a Coda super user)"
echo
echo -n "Enter the uid of this user:"
read userid

if [ x$userid = x ]; then
    echo "Nothing cannot be a Coda administrator"
    echo "Run vice-setup-user again"
    exit 1
fi

if [ x$userid = x0 ]; then
    echo "Root cannot be a Coda administrator"
    echo "Run vice-setup-user again"
    exit 1
fi

pwdline=`grep ":$userid:" /etc/passwd`

if [ x$pwdline = x ]; then
    echo "User id $userid not found"
    echo "Run vice-setup-user again"
    exit 1
fi

user=`echo $pwdline | sed 's/:.*$//' `

if [ x$user = x ]; then
    echo "Username for $userid not found in /etc/passwd"
    echo "Run vice-setup-user again"
    exit 1
fi

echo "System:Administrators   -204    $user" > group.coda
echo $user::$userid::Administrator:: > user.coda

pwd2pdb -u user.coda -g group.coda > vice.pdb
pcfgen vice.pdb

echo "$userid	changeme	admin user" > passwd.coda
initpw -k "drseuss " < passwd.coda > auth2.pw

echo "An initial administrative user $user (id $userid) with Coda password changeme now exists."
