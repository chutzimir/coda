#!/bin/sh
#
# Simple logrotation for Coda server logfiles
#

vicedir=/vice
. "`codaconfedit server.conf`"

srvlog="${vicedir}/srv/SrvLog"
srverr="${vicedir}/srv/SrvErr"
authlog="${vicedir}/auth2/AuthLog"

for i in 9 8 7 6 5 4 3 2 1 0 ; do
    j=`expr $i + 1`
    mv -f "${srvlog}-$i"  "${srvlog}-$j"
    mv -f "${srverr}-$i"  "${srverr}-$j"
    mv -f "${authlog}-$i" "${authlog}-$j"
done

mv -f "${srvlog}"  "${srvlog}-0"
mv -f "${srverr}"  "${srverr}-0"
mv -f "${authlog}" "${authlog}-0"

# Tell codasrv and auth2 to reopen their logfiles
kill -HUP `cat ${srvdir}/pid`
kill -HUP `cat ${authdir}/pid`

# alternatively use one of the following,
## run volutil in the background, just in case the server isn't running.
# volutil swaplog &
# killall -HUP codasrv
#
# and,
# killall -HUP auth2
